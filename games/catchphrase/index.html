<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.8, maximum-scale=1.0, user-scalable=yes">
    <title>Catch Phrase Game</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="manifest" href="manifest.json">
    <link rel="shortcut icon" href="assets/img/icon.png" type="image/x-icon">

    <!-- Moblie Download Settings -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
</head>

<body>
    <div class="container home-container" id="home">
        <h1>Catch Phrase</h1>
        <button id="play-btn" class="click-sound">Play!</button>
    </div>

    <div class="container game-container" id="game">
        <div class="lose-container-darken" id="lose-container-darken"></div>
        <div class="lose-container" id="lose-container">
            <h1>You lost</h1>
            <p class="lose-container-subtext">The potato got too hot</p>
            <p class="lose-container-maintext">Press continue and give the other team a point</p>
            <button onclick="CloseLoseContainer()">Continue</button>
        </div>

        <div class="game-content">
            <div class="game-header">
                <h3>Your word is:</h3>
                <h1 class="game-word" id="game-word">Loading...</h1>
            </div>
            <button class="game-skip-btn click-sound" id="skip-btn">Skip Word</button>
            <button class="game-correct-btn" id="correct-btn">Correct</button>
        </div>
        <button onclick="RestartGame()" class="restart-game-btn click-sound">Restart</button>
        <div class="progress-bar">
            <div id="progress-bar"></div>
        </div>

        <div class="team-container team1">
            <h4>Team 1 Score</h4>
            <span id="team1-score">0</span>
            <button onclick="AddT1Score(1)" class="score-btn click-sound">+</button>
            <button onclick="AddT1Score(-1)" class="score-btn click-sound">-</button>
        </div>
        <div class="team-container team2">
            <h4>Team 2 Score</h4>
            <span id="team2-score">0</span>
            <button onclick="AddT2Score(1)" class="score-btn click-sound">+</button>
            <button onclick="AddT2Score(-1)" class="score-btn click-sound">-</button>
        </div>
    </div>

    <audio id="ClickSound" src="assets/audio/click.mp3" preload="auto"></audio>
    <audio id="CorrectSound" src="assets/audio/correct.mp3" preload="auto"></audio>

    <script src="js/main.js"></script>
    <script>
        function RestartGame() {
            if (confirm("Are you sure you want to restart the game?")) {
                location.reload()
            }
        }
        const loseContainer = document.getElementById("lose-container")
        const loseContainerDarken = document.getElementById("lose-container-darken")
        function CloseLoseContainer() {
            loseContainer.style.display = "none"
            loseContainerDarken.style.display = "none"
        }
        (async () => {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const data_buf = await fetch("assets/audio/click.mp3")
                .then( resp => resp.arrayBuffer() );
            const audio_buf = await ctx.decodeAudioData(data_buf);

            const clickSoundElements = document.querySelectorAll(".click-sound")
            clickSoundElements.forEach(element => {
                element.addEventListener("touchstart", (evt) => {
                    const source = ctx.createBufferSource();
                    source.buffer = audio_buf;
                    source.connect(ctx.destination);
                    source.start(0);
                }, {passive: true})
            });

            const ctx0 = new (window.AudioContext || window.webkitAudioContext)();
            const data_buf0 = await fetch("assets/audio/correct.mp3")
                .then( resp => resp.arrayBuffer() );
            const audio_buf0 = await ctx0.decodeAudioData(data_buf0);

            const correctButton = document.getElementById("correct-btn")
            var correctDebounce = false
            correctButton.addEventListener("touchstart", (evt) => {
                const source = ctx0.createBufferSource();
                source.buffer = audio_buf0;
                source.connect(ctx0.destination);
                source.start(0);
            }, {passive: true})
        })();
        var t1Score = 0
        var t2Score = 0
        function AddT1Score(amount) {
            const score = document.getElementById("team1-score")
            t1Score+=amount
            if (t1Score <= 0) {
                t1Score = 0
            } else if (t1Score > 9) {
                t1Score = 9
            }
            score.innerText = t1Score
        }
        function AddT2Score(amount) {
            const score = document.getElementById("team2-score")
            t2Score+=amount
            if (t2Score <= 0) {
                t2Score = 0
            } else if (t2Score > 9) {
                t2Score = 9
            }
            score.innerText = t2Score
        }
    </script>
</body>

</html>